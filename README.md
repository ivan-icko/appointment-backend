# Appointment Scheduling API

[![NestJS](https://img.shields.io/badge/NestJS-10.0-E0234E?logo=nestjs&logoColor=white)](https://nestjs.com/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.1-3178C6?logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![SQLite](https://img.shields.io/badge/SQLite-ORM-003B57?logo=sqlite&logoColor=white)](https://www.sqlite.org/)
[![License](https://img.shields.io/badge/License-UNLICENSED-lightgrey)](#license)

Fast, well-structured NestJS backend for managing medical appointments. Includes a TypeORM-powered SQLite datastore, request validation, structured logging, and autogenerated OpenAPI docs to help you move from prototype to production-ready APIs quickly.

## Table of Contents
- [Overview](#overview)
- [Key Features](#key-features)
- [Tech Stack](#tech-stack)
- [Architecture at a Glance](#architecture-at-a-glance)
- [API Surface](#api-surface)
  - [Sample Payloads](#sample-payloads)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Installation](#installation)
  - [Environment Setup](#environment-setup)
  - [Database](#database)
  - [Run the Server](#run-the-server)
- [Running Tests](#running-tests)
- [Configuration](#configuration)
- [Logging](#logging)
- [Project Scripts](#project-scripts)
- [License](#license)

## Overview

This service exposes a RESTful API to book, list, and cancel appointments. Time-slot conflicts are rejected automatically, and every request/response is wrapped in structured logs that can be shipped to your observability stack. Swagger docs are generated in development, making it easy to explore the contract or hand it over to a frontend team.

Realistic defaults (SQLite, `.env` support, Docker-free local setup) keep onboarding friction low, while NestJS modules and DTO validation make the codebase easy to extend with additional resources.

## Key Features

- Deterministic scheduling logic that prevents overlapping appointments or cross-day bookings.
- Request DTOs backed by `class-validator` ensure every payload is well-formed before it reaches the service layer.
- Custom Winston logger (request-scoped) injects a trace id into every log line and supports multiple transports.
- OpenAPI (Swagger) docs available at runtime for rapid API discovery.
- TypeORM integration with UUID primary keys and automatic schema synchronization for local development.

## Tech Stack

- `NestJS 10` with Express platform
- `TypeScript 5`
- `TypeORM` with `SQLite` default database
- `class-validator` and `class-transformer`
- `Winston` with daily rotating files
- `Jest` and `SuperTest` for unit and e2e testing

## Architecture at a Glance

| Layer | Highlights |
| ----- | ---------- |
| `src/modules/appointments` | Core domain logic for listing, creating, and canceling appointments, plus DTOs and entity definitions. |
| `src/common/modules/logger` | Request-scoped logger service, providers, and transport factories. |
| `src/common/interceptors/logger.interceptor.ts` | Captures request/response pairs, adds trace ids, and records latency. |
| `src/app.module.ts` | Bootstraps configuration, logging, database connection, and aggregates feature modules. |
| `src/main.ts` | CORS setup, Swagger registration in development, environment-driven bootstrap. |

The project follows modular NestJS patterns, keeping controllers thin, pushing business rules into services, and sharing cross-cutting utilities from `src/common`.

## API Surface

All endpoints are prefixed with `/` and served on the configured `PORT` (default `3000`).

| Method | Route | Description |
| ------ | ----- | ----------- |
| `GET` | `/hello-world` | Health-style endpoint that exercises the logging interceptor. |
| `GET` | `/appointments` | Lists all upcoming appointments ordered by date and start time. |
| `GET` | `/appointments/:date` | Returns appointments scheduled for a specific day (`YYYY-MM-DD`). |
| `POST` | `/appointments` | Creates a new appointment after validating time slot availability. |
| `DELETE` | `/appointments/:id` | Cancels an appointment by UUID. |

### Sample Payloads

```http
POST /appointments
Content-Type: application/json

{
  "patientName": "Ada Lovelace",
  "description": "Initial consultation",
  "date": "2024-11-25",
  "startTime": "09:30",
  "duration": 60
}
```

| Field | Notes |
| ----- | ----- |
| `date` | ISO `YYYY-MM-DD` string. |
| `startTime` | `HH:mm` 24-hour format. |
| `duration` | Minutes, constrained between 30 and 180. |

The service rejects requests when the time slot overlaps with an existing appointment or would end on the following day.

## Getting Started

### Prerequisites

- Node.js 20+
- pnpm, npm, or yarn (any works with the provided lockfiles)

### Installation

```bash
pnpm install
# or
npm install
```

### Environment Setup

Create a `.env` file (optional) and override only the values you need:

| Variable | Default | Purpose |
| -------- | ------- | ------- |
| `PORT` | `3000` | Server port. |
| `APP_NAME` | `backend` | Used for Swagger title. |
| `DOCS_PATH` | `docs` | Path segment that serves Swagger UI. |
| `FRONT_APP_ORIGIN` | `https://www.test.rs` | Allowed CORS origins (comma-separated, supports regex strings). |
| `LOGGER_TRANSPORTS` | `console` | Comma-separated transports (`console`, `daily_rotate`). |

### Database

SQLite is configured out of the box. The file `appointments.db` is created automatically and synchronized by TypeORM on startup. Swap in another driver by editing the `TypeOrmModule.forRoot` call within `src/app.module.ts`.

### Run the Server

```bash
npm run start:dev       # watch mode with live reload
npm run start           # single run
npm run start:prod      # uses compiled output in dist/
```

Visit `http://localhost:3000/docs` when running in development to explore the OpenAPI UI.

## Running Tests

The project ships with Jest and Nest's testing utilities.

```bash
npm run test        # unit tests
npm run test:e2e    # e2e tests (configure test database if needed)
npm run test:cov    # coverage report
```

Add new tests under `src/**/*.spec.ts` or `test/**/*` depending on scope.

## Configuration

Configuration is powered by `@nestjs/config` and the helper utilities in `src/common/utils/string.util.ts`. Values are loaded once per process and made globally available. Sensible defaults allow the app to boot without a `.env`, yet every parameter can be overridden where needed.

## Logging

- Request-scoped `LoggerService` enriches every log entry with a trace id and optional metadata.
- `LoggerInterceptor` wraps controllers, logging inbound requests and outbound responses with duration.
- Transports are configurable via environment variables, and logs can be routed to rotating files out-of-the-box.

## Project Scripts

| Script | Description |
| ------ | ----------- |
| `npm run build` | Compile TypeScript to `dist/`. |
| `npm run lint` | Run ESLint with auto-fix. |
| `npm run format` | Prettier format for `src/` and `test/`. |
| `npm run test:*` | Execute the corresponding Jest target. |

## License

This project is currently distributed without an open-source license (`UNLICENSED`). Add your preferred license file before making the repository public.

---

Questions or feedback are welcomeâ€”open an issue or drop a note once the repository is live.
